<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="60">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--<script src="js/newbian.js"></script>
    <script src="js/newbter.js"></script>

    -->
    <script src="js/newre.js"></script>
    <script src="js/newhb.js"></script>
    <script src="js/newbian.js"></script>
    <script src="js/newbter.js"></script>
    <script src="js/newok.js"></script>
    <script src="js/newmc.js"></script>
    <script src="js/newzb.js"></script>
    <script src="js/newbs.js"></script>
    <script src="js/newkb.js"></script>

    <script type="text/javascript">
        setInterval(testsession,10000);
        function testsession()
        {
            //sessionStorage
            $(document).ready ( function(){
                $.ajax({
                    type:"GET",
                    url:"/check",
                    async:false,
                    dataType:'json',
                    success:function(result){
                        if(result.code=='0')
                        {
                            alert('登录失效');

                            self.location="\\";
                            closeallsocket();
                        }
                    }
                })});
        }
    </script>
    <title>NewSocket</title>
</head>
<body>
<input type="text" id="hbbtcprice"></input>
<input type="text" id="hbethprice"></input>
<table id="tbody" border="1">
    <th>买入机构</th><th>买入交易对</th><th>获利比率</th><th>卖出机构</th><th>卖出交易对</th>
</table>
</body>
<script type="text/javascript">
    window.onload=function () {
        testsession();
    };
    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
    window.onbeforeunload = function () {
        closeallsocket();
    };
    //关闭所有socket
    function closeallsocket() {
        websocketre.close();
        websockethb.close();
        websocketok.close();
        websocketzb.close();
        websocketmc.close();
        websocketbter.close();
        websocketbian.close();
        websocketbs.close();
        websocketkb.close();
    }
</script>
</html>